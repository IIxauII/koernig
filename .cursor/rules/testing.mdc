---
description: Testing best practices, patterns, and conventions for unit, component, and E2E tests
globs: ["**/*.spec.ts", "**/*.test.ts", "**/*e2e/**/*.ts"]
alwaysApply: false
---

# Testing Best Practices

This project uses Jest for unit testing and Playwright for E2E testing.

## Unit Testing

* **Test Location:** Place test files alongside source files: `*.spec.ts`
* **Test Naming:** Use descriptive test names: `describe('FilmService', () => { it('should load films from storage', () => { ... }) })`
* **Test Structure:** Follow AAA pattern: Arrange, Act, Assert
* **Mocking:** Use Jest mocks for dependencies. Mock Ionic Storage, not the actual storage implementation.

## Component Testing

* **Angular Testing Utilities:** Use Angular testing utilities (`TestBed`, `ComponentFixture`, etc.)
* **Standalone Components:** Test standalone components by importing necessary dependencies
* **Change Detection:** Manually trigger change detection when needed: `fixture.detectChanges()`
* **Async Operations:** Use `fakeAsync` and `tick()` for testing async operations, or `waitForAsync` for observables

## NGXS Store Testing

* **Store Testing:** Test stores in isolation using `NgxsModule.forRoot([FeatureState])`
* **Action Testing:** Test action handlers with proper state context
* **Selector Testing:** Test selectors independently
* **Mock Dependencies:** Mock services used in action handlers

## Service Testing

* **Service Isolation:** Test services in isolation, mocking dependencies
* **Storage Mocking:** Mock Ionic Storage service for storage-dependent services
* **Error Cases:** Test error handling and edge cases

## E2E Testing

* **Playwright:** Use Playwright for E2E tests in `apps/mobile-e2e/`
* **Page Object Model:** Consider using Page Object Model pattern for complex E2E tests
* **Test Data:** Use test fixtures or factories for consistent test data
* **Mobile Testing:** Test on mobile viewports, not just desktop

## Test Coverage

* **Coverage Goals:** Aim for high coverage on business logic and services
* **Coverage Reports:** Use `pnpm nx test --coverage` to generate coverage reports
* **Critical Paths:** Ensure critical user flows have E2E test coverage

## Best Practices

* **Fast Tests:** Keep unit tests fast (< 100ms each)
* **Independent Tests:** Tests should not depend on each other
* **Deterministic:** Tests should produce the same results every time
* **Clear Assertions:** Use descriptive assertion messages
* **Test Data:** Use factories or builders for test data creation
